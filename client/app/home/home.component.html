<div [ngfFixOrientation]="false" appFileDrop fxFlex fxLayout="column">

    <mat-sidenav-container #navContainer fxFlex fxLayout="column">
        <mat-sidenav *ngIf="showNavigationMenu()" class="menuMinimized" id="menu" mode="side" opened="true" position="start">
            <div fxFlex fxFlexAlign="start center" fxLayout="row">
                <perfect-scrollbar fxLayout="column">

                    <ng-container *ngIf="user">

                        <mat-nav-list>
                            <!-- Dashboard -->
                            <a [queryParams]="null"
                               [routerLinkActiveOptions]="{ exact: true }"
                               mat-list-item
                               routerLink="/"
                               routerLinkActive="active"
                            >
                                <natural-icon mat-list-icon name="home"></natural-icon>
                                <span matLine>Accueil</span>
                            </a>

                            <!-- Collections publiques -->
                            <a mat-list-item
                               matTooltip="Collections publiques"
                               matTooltipPosition="after"
                               routerLink="/collection"
                               routerLinkActive="active"
                            >
                                <natural-icon mat-list-icon name="collections"></natural-icon>
                            </a>

                            <!-- Mes collections privées -->
                            <a mat-list-item
                               matTooltip="Mes collections"
                               matTooltipPosition="after"
                               routerLink="/my-collection"
                               routerLinkActive="active"
                            >
                                <natural-icon mat-list-icon name="collections_bookmark"></natural-icon>
                            </a>

                            <!-- Fonds -->
                            <a mat-list-item matTooltip="Fonds" matTooltipPosition="after" routerLink="/source" routerLinkActive="active">
                                <natural-icon mat-list-icon name="folder_special"></natural-icon>
                            </a>

                            <!-- Users -->
                            <a *ngIf="user.role === 'administrator'"
                               mat-list-item
                               matTooltip="Liste des utilisateurs"
                               matTooltipPosition="after"
                               routerLink="/user"
                               routerLinkActive="active"
                            >
                                <natural-icon mat-list-icon name="group"></natural-icon>
                            </a>

                            <!-- Notifications -->
                            <a mat-list-item
                               matTooltip="Notifications"
                               matTooltipPosition="after"
                               routerLink="/notification"
                               routerLinkActive="active"
                            >
                                <natural-icon mat-list-icon name="notifications"></natural-icon>
                            </a>

                            <!-- Add photos -->
                            <a (filesChange)="uploadPhoto($event)"
                               *ngIf="user.role === 'administrator' || user.role === 'senior' || user.role === 'junior'"
                               [ngfFixOrientation]="false"
                               mat-list-item
                               matTooltip="Ajouter une image"
                               matTooltipPosition="after"
                               multiple="1"
                               ngfSelect
                            >
                                <natural-icon mat-list-icon name="file_upload"></natural-icon>
                            </a>
                        </mat-nav-list>

                        <mat-divider *ngIf="user.role === 'administrator' || user.role === 'senior' || user.role === 'junior'"></mat-divider>
                        <mat-nav-list *ngIf="user.role === 'administrator' || user.role === 'senior' || user.role === 'junior'">

                            <!-- Institutions -->
                            <a mat-list-item
                               matTooltip="Institutions"
                               matTooltipPosition="after"
                               routerLink="/institution"
                               routerLinkActive="active"
                            >
                                <natural-icon mat-list-icon name="place"></natural-icon>
                            </a>

                            <!-- Artists -->
                            <a *ngIf="site === Site.dilps"
                               mat-list-item
                               matTooltip="Artistes"
                               matTooltipPosition="after"
                               routerLink="/artist"
                               routerLinkActive="active"
                            >
                                <natural-icon mat-list-icon name="copyright"></natural-icon>

                            </a>

                            <ng-container *ngIf="site === Site.tiresias">

                                <!-- Periods -->
                                <a mat-list-item
                                   matTooltip="Périodes"
                                   matTooltipPosition="after"
                                   routerLink="/period"
                                   routerLinkActive="active"
                                >
                                    <natural-icon mat-list-icon name="period"></natural-icon>
                                </a>

                                <!-- Tags -->
                                <a mat-list-item matTooltip="Tags" matTooltipPosition="after" routerLink="/tag" routerLinkActive="active">
                                    <natural-icon mat-list-icon name="tag"></natural-icon>
                                </a>

                                <!-- Domain -->
                                <a mat-list-item
                                   matTooltip="Domaines"
                                   matTooltipPosition="after"
                                   routerLink="/domain"
                                   routerLinkActive="active"
                                >
                                    <natural-icon mat-list-icon name="work"></natural-icon>
                                </a>

                                <!-- Material -->
                                <a mat-list-item
                                   matTooltip="Matériaux"
                                   matTooltipPosition="after"
                                   routerLink="/material"
                                   routerLinkActive="active"
                                >
                                    <natural-icon mat-list-icon name="material"></natural-icon>
                                </a>

                                <!-- Document type -->
                                <a mat-list-item
                                   matTooltip="Type de documents"
                                   matTooltipPosition="after"
                                   routerLink="/document-type"
                                   routerLinkActive="active"
                                >
                                    <natural-icon mat-list-icon name="insert_drive_file"></natural-icon>
                                </a>

                            </ng-container>

                            <!-- Carousel -->
                            <a mat-list-item matTooltip="News" matTooltipPosition="after" routerLink="/newses" routerLinkActive="active">
                                <natural-icon mat-list-icon name="view_carousel"></natural-icon>
                            </a>

                        </mat-nav-list>
                        <mat-divider></mat-divider>
                        <mat-nav-list fxFlex>
                            <!-- Account -->
                            <a (click)="editUser()" mat-list-item matTooltip="Mon compte" matTooltipPosition="after">
                                <natural-icon mat-list-icon name="account_circle"></natural-icon>

                            </a>

                            <!-- Logout -->
                            <a (click)="userService.logout()" mat-list-item matTooltip="Se déconnecter" matTooltipPosition="after">
                                <natural-icon mat-list-icon name="exit_to_app"></natural-icon>
                            </a>
                        </mat-nav-list>

                    </ng-container>

                    <mat-nav-list *ngIf="!user" fxFlex>

                        <!-- Dashboard -->
                        <a [routerLinkActiveOptions]="{ exact: true }" mat-list-item routerLink="/" routerLinkActive="active">
                            <natural-icon mat-list-icon name="home"></natural-icon>
                            <span matLine>Accueil</span>
                        </a>

                        <!-- Logout -->
                        <a (click)="userService.revokeTempAccess()" mat-list-item matTooltip="Se connecter" matTooltipPosition="after">
                            <natural-icon mat-list-icon name="account_circle"></natural-icon>
                        </a>
                    </mat-nav-list>

                    <!-- Bottom nav -->
                    <a *ngIf="errors.length"
                       [matMenuTriggerFor]="errorsMenu"
                       color="warn"
                       mat-icon-button
                       mat-raised-button
                       style="margin:0 11px"
                    >
                        <mat-icon>error</mat-icon>
                    </a>

                    <mat-nav-list>
                        <!-- Theme -->
                        <a (click)="themeService.toggleNightMode()" mat-list-item>
                            <natural-icon mat-list-icon name="invert_colors"></natural-icon>
                            <span matLine>Changer couleurs</span>
                        </a>
                    </mat-nav-list>

                </perfect-scrollbar>
            </div>
        </mat-sidenav>

        <div fxFlex fxLayout="row" id="appContent">
            <router-outlet></router-outlet>
        </div>

    </mat-sidenav-container>

</div>

<mat-menu #errorsMenu="matMenu" [overlapTrigger]="false" class="padding error-menu" fxLayout="column" fxLayoutGap="60px">
    <div (click)="$event.stopPropagation()"
         *ngFor="let error of errors"
         class="error"
         fxLayout="column"
         mat-menu-item
         style="user-select: text"
    >
        <span class="mat-caption" style="font-weight:bold">{{ error.category }}</span>
        <span class="mat-caption">{{ error.message }}</span>
        <span class="mat-caption">{{ error.debugMessage }}</span>
    </div>
    <button (click)="errors = []" mat-menu-item>
        <mat-icon>close</mat-icon>
        Masquer
    </button>
</mat-menu>
